# Claude Code Logging Plugin

Full-fidelity session logging with AI-summarized Markdown reports.

## Installation

```bash
/plugin install logging
```

## What It Does

Logs every hook event to JSONL (source of truth) and generates Markdown reports with AI summaries:

```
<project>/.claude/logging/YYYY/MM/DD/
â”œâ”€â”€ HH-MM-SS-{session}.jsonl       # Full data, never truncated
â”œâ”€â”€ HH-MM-SS-{session}.md          # Conversation-style report
â””â”€â”€ HH-MM-SS-{session}.cache.json  # Summary cache (auto-generated)
```

## Report Format

```markdown
# Session abc12345

**ID:** `abc12345-...`
**Started:** 2025-01-15 10:30:00

---

`10:30:00` ðŸ’« SessionStart startup

---

`10:30:05` ðŸ„ User: Refactor the logging plugin
> Help me refactor the logging plugin

<details>
<summary>ðŸ“¦ 3 tools: Read (2), Edit (1)</summary>

- Read `src/main.py`
- Read `src/utils.py`
- Edit `src/main.py`

</details>

<details>
<summary>`10:30:15` ðŸ”µ Subagent a1b2c3d4 (haiku): Analyzed codebase structure</summary>

**Prompt:**
> Search for all Python files in the project

**Tools:** 2
- Glob `**/*.py`
- Read `/src/main.py`

**Response:**
> Found 12 Python files across 3 directories...

</details>

<details>
<summary>`10:30:20` ðŸŒ² Claude: Refactored plugin to single file</summary>

> Done! I refactored the logging plugin to be more modular...

</details>
```

## AI Summaries

Each User prompt, Claude response, and Subagent response gets a 2-7 word summary generated by Haiku. Summaries are cached to avoid repeated API calls.

**Requirements:** Set `ANTHROPIC_API_KEY` environment variable.

**Without API key:** Logging works normally, summaries are just omitted.

**Cost:** ~$0.0005 per summary (~$0.003 per typical session).

## Querying JSONL

```bash
# View session events
cat .claude/logging/2025/12/08/*.jsonl | jq .

# Extract prompts
jq -r 'select(.type=="UserPromptSubmit") | .data.prompt' .claude/logging/*/*/*.jsonl

# Count events by type
jq -s 'group_by(.type) | map({type:.[0].type, n:length})' .claude/logging/*/*/*.jsonl
```

## Searching Logs

Search through conversation history to recall past discussions. The plugin uses BM25 keyword search with optional semantic capabilities.

### Basic Search

```bash
# Keyword search
uv run plugins/logging/tools/search_logs.py "authentication"

# Search only user prompts
uv run plugins/logging/tools/search_logs.py "bug fix" --type UserPromptSubmit

# Get more results
uv run plugins/logging/tools/search_logs.py "refactor" --limit 20

# Human-readable output
uv run plugins/logging/tools/search_logs.py "error" --format text
```

### Advanced Search Features

```bash
# Get log statistics
uv run plugins/logging/tools/search_logs.py --stats --format text

# Date range filtering
uv run plugins/logging/tools/search_logs.py "authentication" --from today
uv run plugins/logging/tools/search_logs.py "database" --from 7d
uv run plugins/logging/tools/search_logs.py "refactor" --from 2025-12-08 --to 2025-12-11

# Browse specific session
uv run plugins/logging/tools/search_logs.py --session b22351d6 --limit 20

# Show promptâ†’response pairs together
uv run plugins/logging/tools/search_logs.py "learning" --pairs

# Highlight matching terms
uv run plugins/logging/tools/search_logs.py "error" --highlight

# Semantic search (conceptual matching)
uv run plugins/logging/tools/search_logs.py "authentication flow" --semantic

# Full content without truncation
uv run plugins/logging/tools/search_logs.py "debugging" --full
```

### Using the Skill

The `log-search` skill enables Claude to automatically search logs when you ask:
- "What did we discuss about authentication?"
- "Find our previous conversation about the database"
- "When did we work on the refactoring?"
- "Show me today's conversations"
- "What's in the logs from yesterday?"

Run `/log-search` to see full documentation and examples.

## Design Philosophy

- **Full fidelity**: All 10 hook events captured (SessionStart, SessionEnd, UserPromptSubmit, PreToolUse, PostToolUse, PermissionRequest, Notification, PreCompact, Stop, SubagentStop)
- **JSONL source of truth**: Append-only, never truncated, complete data preservation
- **Markdown reports**: Regenerated from JSONL on key events, with emoji timeline and collapsible sections
- **AI summaries**: 2-7 word Haiku-generated summaries with caching to minimize API calls
- **Subagent tracking**: Model, tools, prompts, and responses captured for all subagent work
- **Conversation format**: User/Claude/Subagent exchanges grouped with full context and timestamps
- **Powerful search**:
  - **BM25 keyword search**: Zero-dependency keyword matching (always available)
  - **Semantic search**: Optional embedding-based search for conceptual similarity
  - **Flexible filtering**: By date range, session, event type, and content
  - **Context preservation**: Conversation pairs, full content, and match highlighting

## How It Works

1. **Logging**: Every hook event is captured to JSONL (append-only, never overwritten)
2. **Reporting**: Markdown report is auto-generated from JSONL with AI summaries
3. **Searching**: Search logs by keyword (BM25) or concept (semantic), with flexible filtering
4. **Integration**: Access via CLI commands, Skill API, or Archivist agent persona
